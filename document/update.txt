改版履歴

2012.01.01	ver2.a0.00	開発(アルファ版)
     04.08	ver2.b0.00	ベータ版に移行
     04.09	ver2.b0.01	NTPの設定に不具合
     04.11	ver2.b1.01	設定にNTPブロードキャスト追加
     04.12	ver2.b2.00	NTPの設定判定方法変更
     04.14	ver2.00.00	リリース
     04.15	ver2.00.01	表示バグ修正
     04.19	ver2.01.00	timeen -> timestsに変更
				NTPのLI及び、うるう秒対策。イベント追加
				システム情報ページ追加
				イベントログの表示バグ修正
     04.26	ver2.02.00	DHCPのINIT_REBOOT処理追加
				DHCPのRENEWING,REBINDINGステートにリトライを追加.
				DHCPのリトライ間隔を60秒に変更(最短60秒規定のため)
				Gratuitous ARP処理を入れた。
				(本バージョンはリリースせず)
     04.27	ver2.02.01	LI処理に伴い、クライアントからの問い合わせにLIの状態を
				反映するのを忘れていた(バグ修正)。
     05.06	ver2.02.02	DHCPリトライカウントの初期化忘れ(バグ修正）。
				ファームウェアバージョンをシステム情報に移動
     06.21	ver2.02.03	ICMP宛先不到達の場合ENCリセット
     07.03	ver2.02.04	ICMPリダイレクト処理追加
     07.05	ver2.02.05	Gratuitous ARP時にpacinfoをバックアップしていなかった。
				HTTPのイベントログ(ICMPメッセージ)にデータ１表示追加
				DHCP有効・無効操作時、液晶に表示するようにした
				DHCP無効が効かないのを修正
     07.19	ver2.03.00	WEBページの英語化。
				LIの状態を保持する変数(lists)と、補正状態を保持する変数(timests)
				に分けた。(タイムアウトとかするとうるう秒が判定されないので)
     12.08	ver2.04.00	make_rand()をXorshift方式に変更。(高速処理で、タイマ方式より散らばるので)
				NTPサーバ設定を即時反映にした。(サーバメンテナンス時に変更できるように)
				NTP補正周期を±16秒ランダムに振るようにした。(同じ時間でぶつからないように)
				NTP補正幅を設定できるようにした。(0-65535,0は判定無効,絶対値)
		ver2.04.01	マスク定義や定数定義変更(userdef.h入れ替え)
     12.19	ver2.05.00	NTPブロードキャスト受信許可を入れた
2013.01.05	ver2.05.01	RFC5905により下記変更
				 1.時刻配信のRefIDをIPアドレスに変更。(IPv4使用のため)
				 2.非同期時のStratumを16にする(stratum初期値も)
				参照サーバが非同期のときはLI=3にせずLI=0で内部時刻を保持するようにした
				(次の参照サーバ問い合わせまで、内部の時刻で提供できるようにするため)
				時刻許容幅をミリ秒から秒に変更。(不正時刻の破棄なので、秒単位で大丈夫なので)
				NTPブロードキャスト受信のバグ修正(常に受け入れるようになっていた)。
     01.07	ver2.05.02	リブート時のDHCP処理にバグ。dhcpモードが常にREBOOTになるようになっていた。
     01.25	ver2.06.00	RXSUM ERRORをICMP,TCP,UDPで分けた。(調査の利便性のため)
				ソースファイル構成見直し。関数名見直し。
				--- バグ修正 ---
				NTP要求処理、DHCP再申請処理の通信エラーがログに残っていなかった。
				NTP要求周期を、ntpdに合わせ64秒から2倍ずつ変移するようにした。(MAX8192sec)
				ARPキャッシュ時間を255秒から14400秒(4h)に変更。(Ciscoルータの初期値)
				(ARPキャッシュ切れにより、NTP要求タイムアウトが発生していると思われる)
				DHCP無限リース時の表示バグ修正(--:--:--になっていた)
    05.08			log2()の4捨5入をやめた(簡単にできないので)
    06.10	ver2.06.01	拡張コネクタに状態を出力するようにした。
    07.01	ver2.07.00	TS-GPSclock01とTS-JJY02(要改造)に対応。
				補正間隔を最大4096に変更。
				状態出力を出すようにした。
    07.14	ver2.07.01	PPSのチャタリング除去処理追加。
    07.21	ver2.07.02	PPSのチャタリング除去時間調整。
				ブロードキャスト時のリファレンスID修正。
				タイムゾーン設定を保存するようにした。
				手動設定後の自動補正で、補正幅制限にかかってしまうのを修正。
    07.22	ver2.07.03	強制時刻配信追加。
				ログクリアのキー割り当て変更。
				エラーLED制御入れた。(キー操作で消灯)
    07.24	ver2.07.04	JJYの問い合わせルーチン変更。
				時刻補正インターバルを完全にLinuxに合わせた。(最大1024秒)
				ARPタイムアウトを1200秒(20分、一般的な実装のタイムアウト)に変更。
				能動的時刻補正をログに残さないようにした。
    07.27	ver2.07.05	アドレス表示の＊を廃止、アドレスの説明に変えた。
				ブロードキャストログ(液晶)の右端をページ表記にした。
    07.29	ver2.07.06	ブロードキャストログページの表示バグ修正。
    08.08	ver2.08.00	イベントログからエラーLEDをリセットできるようにした。
				液晶の自動判定廃止。初期は液晶有りに。
				名前解決ルーチン変更。NetBIOSとDNSのキャッシュ共通化。
				NTPサーバに、NetBIOSの名前を使用できるようにした。
				イベント項目整理。
    08.20	ver2.08.01	--- バグ修正 ---
				NetBIOS名での補正時に、CAL REM値がカウントダウンしなかった。
				CGRAM転送を液晶初期化に入れた。(再初期化時CGRAMが消えてしまうので)
				DHCPの無期限リースでInfinity表示にならなかった。
				ipstr2bin()で異常文字の場合0.0.0.0と同様の処理にした。(アドレス解決の方法が以前と変わったので)
				NBNSの返答解析処理にバグ。IPアドレス取得位置が間違っていた。
				NetBIOS名でのSNTP問い合わせ不具合を修正。
    09.30	ver2.08.02	HTTPのHEADメソッドに対応。
				EEPROMの自動初期化を入れた。
				JJYモードで初期画面を追加。(未接続だと何も表示されないので)
				DHCPで、IPアドレスが解決されたときに画面が更新されないのを修正
    10.27	ver2.08.03	ブラウンアウトリセットはエラーLED点けるようにした。
				UDPのリセットコマンドにCRLFを追加。
				トライステートTS-NTP-SERVER01に移植。
    10.19	ver2.09.00	7セグモジュール対応。
    10.27	ver2.09.01	ブラウンアウトリセットはエラーLED点けるようにした。
				UDPのリセットコマンドにCRLFを追加。
    12.09	ver2.10.00	2.08系と2.09系を統一(ハードは2.09系互換)
				ヒューズビットとロックビットをソースコードに追加。
				ボーレート、NMEAフォーマット、７セグ許可の設定を追加。
				middle.cは、ソース内埋め込みとした。
				usedef.h更新。
				char型整理(マイナス要らないものはbyteへ)
2014.05.02	ver2.11.00	DHCPのDNSオプションが1個しか想定されていなかった。
				NTPタイムアウト時3回までリトライするようにした。
				Webページに@が出ることがあるのを対策。

     06.03	ver2.12.00	イベントログを分割送信にした。
				 (長いメッセージが続くとフレーム長を超えてしまうので)
				GPZDA,GPRMCに対して、秒を+1とした。
				 (PPS->メッセージの順が多く、次のPPSでmsがリセットされてしまう)
				ICMPサムエラー時、タイプ、コード、チェックサム値を保存するようにした。
     07.30	ver2.13.00	ICMPサムエラー時のDATA1を送信先IPアドレスに変更。
				PPSのエッジを選べるようにした。
				7セグの有効・無効にバグ。
				GPS補正時、更新時刻を0msとした。($PFEC,GPtpsのデコード時を保存していたため、NTPの最終更新時刻が999msになってしまう)
				GPSのUTCモード時は常時時刻採用、PPS出力ありの情報がない(*U)時は$PFEC,GPtpsのデコード終了を0msとした
				$GPRMCの処理変更(データ無効に切り替わっても時刻保持できるように)
     08.06	ver2.13.01	userdef.h入れ替え、BD_X,BD_XINVの定義変更
     08.31	ver2.14.00	MTK3339モード追加。GPSモード表記変更(1行目)
				userdef.h入れ替え、BD_X,BD_XINVの定義変更
				ENC28J60,MTK3339初期化エラー処理追加。
				GPSとJJYの時刻処理タイミング統一。(各モジュールで正秒に処理)
				TS-JJY02のPPSはUTCから100ms遅れるので、補正値を100msとした。
				$GPZDA廃止(補正状態が判らないので)
				ver2.13.00のEEP領域(7セグ,PPSのエッジ)が他の領域と重なっていたので移動。
				NMEAデータ非受信タイムアウトと非同期タイムアウトを設けた。
				NMEAデータ(時刻)をモジュールに合わせ+1できるようにした。
     09.01	ver2.14.01	NMEA調整の設定バグ修正。
     09.09	ver2.14.02	NTP非同期イベントログに対象のNTPサーバを記録するようにした。
     09.19	ver2.15.00	NTP,NTPブロードキャスト補正にslewモード追加。
				128ms以上のズレでstepモードになる。(設定で判定値変更可能)
     09.23	ver2.16.00	PPSおよびNMEA簡易出力機能追加。
     09.24	ver2.16.01	バグ修正(NMEA出力なしのときも送信されていて、動作が止まってしまう)
				NTPサーバ設定時にポインタを0に(次の時エラーが出ないように)
     09.26	ver2.16.02	計時をタイマ0のみにした。
				Webページのシステム情報画面で、IPアドレスなどをDHCPかFIXか表示するようにした。
     10.09			GPS,JJYモード時、フリーラン状態になってしまうバグ修正。
     10.11	ver2.16.03	JJYモードのときに、NMEAの秒調整が採用されていたので修正。
				(必ず、問い合わせた次の秒で+1採用)
     10.19	ver2.17.00	2項目をDHCPから取れるようにした。(取れたら上書き)
				IPのTTL値,ARPキャッシュタイムアウト
				設定から時刻設定を削除(単体運用できないので)
     12.28	ver2.18.00	GPS NDTOUT,GPS USTOUTの設定が0のときは、エラーまでのカウントしないようにした。
				最大ポーリング間隔の設定追加。
				log2xバグ(ループ終了条件違う)
2015.12.27	ver2.19.00	うるう秒対応(ローカル処理)
				NTPインターバルを最低60秒に(ポーリング間隔守るため)
2016.01.24	ver2.20.00	うるう秒時のサーバ応答／配信を修正。(NICT公開資料に合わせた)
				FURUNOのGPtps受信時を999msとする(次の1ms割り込みが正秒,1PPS入力あるときは1PPS時正秒)
				NTP補正時のLI状態を表示するようにした。
				補正量が333msより大きい時は、インターバル短くするようにした。
				NTPモード時LI状態表示
				　通常は参照先のNTPサーバ位置(いままでの表示)
				　LI=1(挿入=60秒)　Iを表示
				　LI=2(削除=59秒)　Dを表示
				　LI=3(アラーム状態) Aを表示
     02.13	ver2.21.00	GPZDAセンテンス追加(FURUNO,汎用)
				$--RMC,$--ZDA対応。
				秒補正量(NO ADJUST→+0 SECOND)に表示変更。
				asc2datetime( )変更
				TIMER0割り込み時のFURUNO処理を変更(即時)
				NMEAセンテンス、ARPタイムアウト設定追加
     02.21	ver2.22.00	UDPコマンド追加。
     04.20	ver2.23.00	割り込み処理改善(INT0,TMR2)
				DHCP,ブロードキャストを設定に移動
     05.10	ver2.24.00	設定にDHCP、受信補正追加
				電源投入時特殊キー廃止(初期化のみ継続)
2018.04.23	ver2.25.00	YICモジュール対応で、NMEAの3文字分だけ判断するようにした。
				受信リングバッファを128->256byte,処理しきれていないようなので。
				NTPサーバ応答の修正　時刻は常に配信・ステータスはエラー(ntpdに合わせた)
				アラーム時のSTRATUMは、RFC5905に基づき16に変更。
2021.11.19	ver2.26.00	LCD WRITEONLY
				FURUNOモード削除(ディスコンにつき)
				JJYモード削除(電波届きにくくなってきたので)
				NMEAを3文字目から判断(--RMCもGPRMCも同じ)
				補正を100ms時点のエッジに変更(0msに処理ぶつからないように)
				PPSエッジ初期値 上昇
以上
